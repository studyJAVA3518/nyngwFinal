<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.nyngw.electronicApproval.individualDocumentBox.dao.individualDocumentBoxDao">

	<!-- 상신문서함 -->
	<select id="selectSAB" parameterType="java.lang.String" resultType="com.nyngw.dto.Electronic_ApprovalVO">
		select * from Electronic_approval
		where ea_mem_number =  #{mem_number}
	</select>
	
	<!-- 결재번호로 누가 마지막으로 결재했는지 가져오기-->
	<select id="ID_selectAllAS" parameterType="string" resultType="string">
		select mem_name 
		from member
		where mem_number = 
		(select ast_mem_number 
		from approval_step 
		where ast_number = 'ast'||(select max(substr(ah_ast_number,4)) 
		from approval_history 
		where ah_ea_number = #{ea_number}) 
		and ast_ea_number = #{ea_number})
	</select>

	<!-- 결재번호로 최종 결재상태 가져오기 -->
	<select id="ID_selectAhStatus" parameterType="string" resultType="string">
		select ah_status
		from approval_history 
		where ah_ea_number = #{ea_number} 
		and ah_ast_number = (select ast_number 
		from approval_step 
		where ast_number = 'ast'||(select max(substr(ah_ast_number,4)) 
		from approval_history 
		where ah_ea_number = #{ea_number}) 
		and ast_ea_number = #{ea_number})
	</select>
	
	<select id="selectsangsinCount" parameterType="java.lang.String" resultType="java.lang.Integer">
		select count(*) from Electronic_approval
		where ea_mem_number =  #{mem_number}
	</select>
	
	<select id="boardsangsinCount" parameterType="com.nyngw.dto.Board_SelectVO" resultType="java.lang.Integer">
		select count(*) from Electronic_approval
		where ea_mem_number =  #{mem_number}
	</select>



	<!-- 완료문서함 -->
	<select id="selectCAB" parameterType="java.lang.String" resultType="com.nyngw.dto.Electronic_ApprovalVO">
		select * from Electronic_approval
		where ea_mem_number = (select mem_number from member where mem_id = #{mem_id})
		and ea_status = '결재완료'  
	</select>



	<!-- 반려문서함 -->
	<select id="selectRAB" parameterType="java.lang.String" resultType="com.nyngw.dto.Electronic_ApprovalVO">
		select * from Electronic_approval
		where ea_mem_number =  #{mem_number}
	</select>
	
	
	<!-- 결재이력조회 -->
	<select id="selectAhAll" resultType="com.nyngw.dto.Approval_HistoryVO" parameterType="string">
		select * from approval_history
		where ah_ea_number = #{ea_number}
	</select>
	
	<!-- 결재이력 중 자신이 결재한 내역 조회 -->
	<select id="selectAhMember" resultType="com.nyngw.dto.Approval_HistoryVO" parameterType="map">
		select * 
		from approval_history 
		where  ah_ea_number = #{ea_number} 
		and ah_ast_number = (
								select ast_number 
								from approval_step 
								where ast_mem_number = #{mem_number} 
								and ast_ea_number = #{ea_number}
							  )
	</select>
	
	<select id="selectMemberDept" resultType="string" parameterType="string">
		select mem_dept_number from member where mem_number = #{mem_number}
	</select>
	
	<select id="selectEaStepMember" resultType="string" parameterType="map">
		select ast_mem_number from approval_step 
		where ast_number = #{ast_number}
		and ast_ea_number = #{ast_ea_number} 
	</select>
	
	<select id ="selectDeptName" resultType="string" parameterType="string">
		select dept_name from department where dept_number = #{dept_number}
	</select>
	
	<select id="selectMemberPosition" resultType="string" parameterType="string">
		select mem_position_number from member where mem_number = #{mem_number}
	</select>
	
	<select id="selectPositionName"  resultType="string" parameterType="string">
		select position_name from position where position_number = #{position_number}
	</select>
</mapper>
